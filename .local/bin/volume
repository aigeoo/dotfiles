#!/bin/sh

# Increment, decrement, or mute the volume using PulseAudio and send a notification

case $1 in
	up)
		pactl set-sink-mute @DEFAULT_SINK@ 0
		pactl set-sink-volume @DEFAULT_SINK@ +5%
		;;
	down)
		pactl set-sink-mute @DEFAULT_SINK@ 0
		pactl set-sink-volume @DEFAULT_SINK@ -5%
		;;
	mute)
		pactl set-sink-mute @DEFAULT_SINK@ toggle
		;;
esac

VOLUME=$(pactl get-sink-volume @DEFAULT_SINK@ | grep -Po '[0-9]+(?=%)' | head -1)

DIR="$HOME/.local/share/icons/dunst/"
send_notification() {
    if [ "$1" = "mute" ]; then
        ICON="mute"
        TEXT="Currently muted"
    elif [ "$VOLUME" -lt 33 ]; then
        ICON="low"
        TEXT="Currently at ${VOLUME}%"
    elif [ "$VOLUME" -lt 66 ]; then
        ICON="medium"
        TEXT="Currently at ${VOLUME}%"
    else
        ICON="high"
        TEXT="Currently at ${VOLUME}%"
    fi

    dunstify -a "Volume" -r 9993 -h int:value:"$VOLUME" -i "$DIR/volume-$ICON.svg" "Volume" "$TEXT" -t 2000
}

case $1 in
	mute)
		case "$(pactl get-sink-mute @DEFAULT_SINK@)" in
			*yes* ) send_notification mute;;
			*     ) send_notification;;
		esac;;
	*)
		send_notification;;
esac
